# config_template.yaml
# TG Ultimate Forwarder - 终极转发器 配置文件

# --- 1. 代理配置 (可选) ---
# proxy:
#   enabled: true
#   proxy_type: "socks5" # "socks5", "socks4", "http"
#   addr: "127.0.0.1"
#   port: 1080
#   username: ""
#   password: ""

# --- 2. 账号配置 (必需) ---
# 在 https://my.telegram.org/apps 获取 API ID 和 Hash
# 使用 https://github.com/TelethonP/StringSession/blob/master/generate.py 生成 String Session
accounts:
  - api_id: 123456
    api_hash: "0123456789abcdef0123456789abcdef"
    session_string: "AQ...YOUR_SESSION_STRING...="
    session_name: "account_1" # 仅用于日志，可随意填写
    enabled: true
  
  # - api_id: 123457
  #   api_hash: "0123456789abcdef0123456789abcde0"
  #   session_string: "AQ...ANOTHER_SESSION_STRING...="
  #   session_name: "account_2"
  #   enabled: true

# --- 3. 监控源 (必需) ---
# 运行 `python ultimate_forwarder.py export` 来获取频道/群组的数字ID
sources:
  - id: -1001234567890 # (必需) 源频道/群组 ID
    check_replies: true    # (可选) 是否检查此频道的评论区 (TODO)
    replies_limit: 5       # (可选) 检查评论区的最后5条
    forward_new_only: null # (可选) 覆盖全局设置, true/false

# --- 4. 转发目标 (必需) ---
targets:
  # (必需) 默认转发到的频道/群组 ID
  default_target: -1009876543210
  
  # (可选) 分发规则 (新功能)
  # 按顺序匹配，第一个命中的规则生效
  distribution_rules:
    # 示例1: 转发到默认群组的 "电影" 话题
    - name: "电影分发"
      keywords: ["#电影", "#1080p", "BluRay"] # 包含任一关键词
      target_id: -1009876543210 # 目标群组ID (这里是默认群组)
      topic_id: 123              # 目标话题ID (运行 export 获取)
    
    # 示例2: 转发到 "动漫" 话题
    - name: "动漫分发"
      keywords: ["#动漫", "#BDRip"]
      target_id: -1009876543210
      topic_id: 456
    
    # 示例3: 转发到 *另一个* 专门的 "剧集" 频道
    - name: "剧集分发 (到另一频道)"
      keywords: ["#剧集", "#S01E", "第一季"]
      target_id: -10011112222333 # 另一个频道的ID
      topic_id: null             # 设为 null 或省略，表示不发到话题

# --- 5. 转发行为 ---
forwarding:
  # 转发模式:
  # "forward" = 转发 (保留来源，但如果源频道禁止转发则失败)
  # "copy"    = 复制 (作为新消息发送，可突破转发限制)
  mode: "copy"
  
  # 是否只转发新消息:
  # true  = (默认) 只处理程序启动后收到的新消息。
  # false = 程序启动时，会回溯所有源频道的历史消息 (从上次停止的地方开始)。
  forward_new_only: true

# --- 6. 过滤器 (可选) ---
# 注意: 过滤器在 "白名单" 模式下不生效

# 广告过滤器 (黑名单)
ad_filter:
  enable: true
  keywords:
    - "广告"
    - "推广"
    - "t.me/ad_channel"
  patterns: # 正则表达式
    - "group[0-9]{3,}"

# 内容质量过滤器
content_filter:
  enable: true
  meaningless_words: ["顶", "up", "1", "mark"]
  min_meaningful_length: 10 # 纯文本消息的最小长度 (无媒体时)

# 白名单过滤器 (高优先级)
# 如果启用，只有包含白名单关键词的消息 *才会被转发*
whitelist:
  enable: false
  keywords:
    - "#MyKeep"
    - "重要"

# --- 7. 内容处理 ---

# 内容去重
deduplication:
  enable: true
  db_path: "data/dedup_db.json" # 存储哈希的JSON文件路径

# 高级链接提取
link_extraction:
  check_hyperlinks: true # 是否解析 telegra.ph 和机器人超链接 (TODO)
  check_bots: true       # 是否模拟点击机器人按钮 (TODO)

# 消息内容替换
# (在过滤和分发 *之前* 执行)
replacements:
  # "目标内容": "源内容"
  "": "#ad" # 删除 #ad 标签
  "TG 终极转发器": "TG Bot"
  "t.me/some_other_channel": "" # 删除其他频道链接

# --- 8. 失效链接检测器 (可选) ---
# 通过 `python ultimate_forwarder.py checklinks` 运行
link_checker:
  enabled: true
  # "log"    = 只在日志中报告
  # "edit"   = 编辑原消息，标注 [链接已失效]
  # "delete" = 删除包含失效链接的消息
  mode: "edit"
  # Cron 表达式 (默认: 每天凌晨3点)
  schedule: "0 3 * * *"