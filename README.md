# TG Ultimate Forwarder - ç»ˆæ Telegram è½¬å‘å™¨

æœ¬é¡¹ç›®èåˆäº† `tgforwarder` å’Œ `tg_zf` çš„æ ¸å¿ƒä¼˜åŠ¿ï¼Œå¹¶åŠ å…¥äº†è¯é¢˜åˆ†å‘ã€å¤šæ¨¡å¼è½¬å‘ç­‰æ–°åŠŸèƒ½ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªç¨³å®šã€å¼ºå¤§ä¸”é«˜åº¦å¯é…ç½®çš„ Telegram å†…å®¹èšåˆå·¥å…·ã€‚

# âœ¨ æ ¸å¿ƒåŠŸèƒ½

* **å¤šè´¦å·æ”¯æŒ**: ä½¿ç”¨å¤šä¸ªè´¦å·è½®æ¢è½¬å‘ï¼Œæœ‰æ•ˆè§„é¿ FloodWait å’Œè´¦å·é™åˆ¶ã€‚

* **å¤šæºç›‘æ§ (å·²æ”¯æŒ)**: å¯åœ¨ `config.yaml` ä¸­é…ç½®ä»»æ„å¤šä¸ªæºé¢‘é“ã€‚
  
* **çµæ´»çš„æ ‡è¯†ç¬¦**: æºå’Œç›®æ ‡å‡æ”¯æŒæ•°å­—ID (-100...)ã€ç”¨æˆ·å (@username) å’Œé“¾æ¥ (https://t.me/...)ã€‚

* **Bot äº¤äº’æ§åˆ¶**:

  *  é€šè¿‡ç§èŠ Bot å®æ—¶ç®¡ç†è½¬å‘å™¨ã€‚

  *  /status: æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€å’Œè´¦å·å¥åº·åº¦ã€‚

  *  /reload: çƒ­é‡è½½ config.yamlï¼Œæ— éœ€é‡å¯ Docker å®¹å™¨å³å¯åº”ç”¨æ–°è§„åˆ™ã€‚

  *  /run_checklinks: æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡å¤±æ•ˆé“¾æ¥æ£€æµ‹ã€‚

* **å¤šæ¨¡å¼è½¬å‘**:

  * **Forward æ¨¡å¼**: æ ‡å‡†è½¬å‘ï¼Œä¿ç•™æ¶ˆæ¯æ¥æºã€‚

  * **Copy æ¨¡å¼**: å¤åˆ¶æ¶ˆæ¯å†…å®¹ï¼Œä½œä¸ºæ–°æ¶ˆæ¯å‘é€ï¼Œå¯çªç ´æºé¢‘é“çš„è½¬å‘é™åˆ¶ã€‚

* **é«˜çº§å†…å®¹è¿‡æ»¤**:

  * **è¿‡æ»¤é€»è¾‘ (æ–°)**: æ¸…æ™°çš„è¿‡æ»¤ä¼˜å…ˆçº§ï¼š ç™½åå• (é«˜) > é»‘åå• (ä¸­) > é»˜è®¤é€šè¿‡ (ä½)ã€‚

  * **ç™½åå•**: ä»…è½¬å‘åŒ…å«ç‰¹å®šå…³é”®è¯çš„æ¶ˆæ¯ã€‚

  * **é»‘åå•**: è¿‡æ»¤å¹¿å‘Šã€æ— æ„ä¹‰å†…å®¹ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰ã€‚

* **æ™ºèƒ½å†…å®¹å¤„ç†**:

  * **å†…å®¹æ›¿æ¢**: è‡ªåŠ¨æ›¿æ¢æ¶ˆæ¯ä¸­çš„æŒ‡å®šæ–‡æœ¬ï¼Œå¦‚å¹¿å‘Šæ ‡ç­¾ã€é¢‘é“é“¾æ¥ç­‰ã€‚

  * **é«˜çº§é“¾æ¥æå–**: (TODO) è§£æè¶…é“¾æ¥ã€æœºå™¨äººå›å¤ã€è¯„è®ºåŒºä¸­çš„éšè—é“¾æ¥ã€‚

* **ç²¾å‡†åˆ†å‘ (æ–°)**:

  * **è¯é¢˜åˆ†å‘**: æ ¹æ®å…³é”®è¯å°†æ¶ˆæ¯ç²¾å‡†åˆ†å‘åˆ°ç›®æ ‡ç¾¤ç»„çš„ **ä¸åŒè¯é¢˜ (Topics)** ä¸­ã€‚

  * **å¤šé¢‘é“/ç¾¤ç»„åˆ†å‘**: æ ¹æ®å…³é”®è¯å°†æ¶ˆæ¯åˆ†å‘åˆ°ä¸åŒçš„ç›®æ ‡é¢‘é“æˆ–ç¾¤ç»„ã€‚

  * **æŒ‰æ–‡ä»¶ç±»å‹åˆ†å‘ (æ–°)**: æ ¹æ®æ–‡ä»¶å (`*.mkv`) æˆ–æ–‡ä»¶ç±»å‹ (`video/mp4`) åˆ†å‘ã€‚

* **å¥å£®æ€§è®¾è®¡**:

  * **å†…å®¹å»é‡**: åŸºäºæ¶ˆæ¯å“ˆå¸Œé˜²æ­¢é‡å¤è½¬å‘ã€‚

  * **æ–­ç‚¹ç»­ä¼ **: è‡ªåŠ¨è®°å½•æ¯ä¸ªé¢‘é“çš„è½¬å‘è¿›åº¦ï¼Œé‡å¯åä¸ä¸¢å¤±ã€‚

  * **æ–°æ¶ˆæ¯/å†å²æ¶ˆæ¯**: å¯é…ç½®ä¸ºåªå¤„ç†æ–°æ¶ˆæ¯ (`forward_new_only: true`)ï¼Œæˆ–å›æº¯æ‰€æœ‰å†å²æ¶ˆæ¯ (`false`)ã€‚

* **é…å¥—å·¥å…·**:

  * **å¤±æ•ˆé“¾æ¥æ£€æµ‹**: é™„å¸¦ `link_checker.py`ï¼Œå¯å®šæ—¶æ‰«æã€æ ‡è®°æˆ–åˆ é™¤å¤±æ•ˆçš„ç½‘ç›˜é“¾æ¥ã€‚

  * **é¢‘é“/è¯é¢˜å¯¼å‡º**: `export` æ¨¡å¼å¸®åŠ©ä½ è·å–é…ç½®æ‰€éœ€çš„é¢‘é“å’Œè¯é¢˜ IDã€‚

# ğŸš€ éƒ¨ç½²æŒ‡å— (Docker / æœ¬åœ°)

è¿™æ˜¯æœ€ç®€å•ã€æœ€æ¨èçš„éƒ¨ç½²æ–¹å¼ï¼Œæ”¯æŒ docker attach äº¤äº’å¼ç™»å½•ã€‚

1. **å‡†å¤‡é…ç½®æ–‡ä»¶**:

    * åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¾‹å¦‚` ~/tg_forwarder`ã€‚

    * `mkdir -p ~/tg_forwarder/data` (æ­¤ç›®å½•ç”¨äºå­˜æ”¾ `.session` ç™»å½•æ–‡ä»¶å’Œæ•°æ®åº“)

    * å°† `config_template.yaml` å¤åˆ¶åˆ°è¯¥ç›®å½•ï¼Œå¹¶é‡å‘½åä¸º `config.yaml`ã€‚`

2. **åˆ›å»ºä½ çš„ Bot**:

     *  ç§èŠ @BotFatherã€‚

     *  å‘é€ `/newbot`ï¼ŒæŒ‰æç¤ºåˆ›å»ºä½ çš„ Botï¼Œè·å– `bot_token`ã€‚

     *  ç§èŠ @userinfobotã€‚

     *  æŸ¥çœ‹å›å¤ï¼Œè·å–ä½ è‡ªå·±çš„ `Id` (ä¸€ä¸²æ•°å­—)ã€‚

3. **ç¼–è¾‘** `config.yaml`:

     * `docker_container_name`: å¡«å…¥ä½ ä¸‹ä¸€æ­¥ `docker run` æ—¶ `--name` å‚æ•°æŒ‡å®šçš„åå­— (ä¾‹å¦‚ `tgf`)ã€‚
     * `bot_service`: å¡«å…¥ä½ åˆšè·å–çš„ `bot_token` å’Œ `admin_user_ids` (å¡«ä½ è‡ªå·±çš„æ•°å­— IDï¼Œæ”¯æŒå¤šä¸ª)ã€‚

     * `accounts`: å¡«å…¥ä½ çš„ `api_id, api_hash` å’Œ `session_name` (ä¾‹å¦‚ `account_1`)ã€‚

     * `sources`: å¡«å…¥ä½ è¦ç›‘æ§çš„æºé¢‘é“/ç¾¤ç»„ IDã€‚

     * `targets`: å¡«å…¥é»˜è®¤çš„ç›®æ ‡é¢‘é“/ç¾¤ç»„ IDã€‚

4. **è¿è¡Œ Docker å®¹å™¨**:

    * è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®¹å™¨ã€‚

    * (é‡è¦)é¦–æ¬¡è¿è¡Œæ—¶ï¼Œç¨‹åºä¼šå¡ä½å¹¶ç­‰å¾…ä½ ç™»å½•ã€‚è¯·çœ‹ç¬¬ 5æ­¥ã€‚

  ```bash
  docker run -d \
    -it \
    --name tgf \
    -v ~/tg_forwarder/config.yaml:/app/config.yaml \
    -v ~/tg_forwarder/data:/app/data \
    --restart always \
    dswang2233/tgf:latest
  ```

1. **é¦–æ¬¡ç™»å½• (äº¤äº’å¼)**:

  * å®¹å™¨å¯åŠ¨åï¼Œå®ƒä¼šåœ¨æ—¥å¿—ä¸­æ‰“å° "è¯·åœ¨æ§åˆ¶å°è¾“å…¥æ‰‹æœºå·..."

  * è¿è¡Œ `docker attach tgf` (è¿™é‡Œçš„ `tgf` å¿…é¡»ä¸ä½  `--name` å’Œ `config.yaml` ä¸­è®¾ç½®çš„ä¸€è‡´)ã€‚

  * ä½ ç°åœ¨è¿›å…¥äº†å®¹å™¨çš„äº¤äº’æ¨¡å¼ã€‚

  * æŒ‰ç…§æç¤ºè¾“å…¥ä½ çš„**æ‰‹æœºå·** (ä¾‹å¦‚ `+861234567890`)ï¼ŒæŒ‰å›è½¦ã€‚

  * è¾“å…¥æ”¶åˆ°çš„**éªŒè¯ç **ï¼ŒæŒ‰å›è½¦ã€‚

  * å¦‚æœè®¾ç½®äº†**ä¸¤æ­¥éªŒè¯å¯†ç **ï¼Œè¾“å…¥å¯†ç ï¼ŒæŒ‰å›è½¦ã€‚

  * ç™»å½•æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ç¨‹åºå¼€å§‹æ­£å¸¸è¿è¡Œã€‚

  * æŒ‰ `Ctrl+P` ç„¶åæŒ‰ `Ctrl+Q` æ¥åˆ†ç¦» (Detach) ç»ˆç«¯ï¼Œåƒä¸‡ä¸è¦æŒ‰ `Ctrl+C` (è¿™ä¼šåœæ­¢å®¹å™¨)ã€‚

  * ä½ çš„ç™»å½•æ–‡ä»¶ (`.session`) ç°å·²ä¿å­˜åœ¨ `~/tg_forwarder/data` ç›®å½•ä¸­ï¼Œä¸‹æ¬¡é‡å¯å®¹å™¨å°†è‡ªåŠ¨ç™»å½•ã€‚

# ğŸ› ï¸ æœ¬åœ°è¿è¡Œ (å¼€å‘/è°ƒè¯•)

1. å…‹éš†ä»“åº“: `git clone ...`

2. å®‰è£…ä¾èµ–: `pip install -r requirements.txt`

3. åˆ›å»º `data` ç›®å½•: `mkdir data`

4. å¤åˆ¶ `config_template.yaml` ä¸º `config.yaml`ã€‚

5. é…ç½® `config.yaml` (ä½¿ç”¨ `session_name` æ–¹å¼)ã€‚

6. è¿è¡Œ (é¦–æ¬¡è¿è¡Œä¼šè¦æ±‚åœ¨ç»ˆç«¯ç™»å½•):

     * å¯åŠ¨è½¬å‘: `python ultimate_forwarder.py run`

     * æ£€æµ‹é“¾æ¥: `python ultimate_forwarder.py checklinks`

     * å¯¼å‡ºID: `python ultimate_forwarder.py export`

# âš™ï¸ é…ç½®æ–‡ä»¶è¯¦è§£ (config.yaml)

* `accounts`**(ç™»å½•è´¦å·)**
  ä½ å¿…é¡»æä¾› `session_name`ï¼š

    > `session_name`: (ç”¨äº Docker / æœ¬åœ°) æŒ‡å®šä¸€ä¸ªä¼šè¯æ–‡ä»¶åï¼Œç¨‹åºå¯åŠ¨æ—¶ä¼šè¦æ±‚ä½ äº¤äº’å¼ç™»å½•ã€‚

* `sources` **(ç›‘æ§æº)**
    `id` å¿…é¡»æ˜¯æ•°å­—ID (è¿è¡Œ `export` æ¨¡å¼è·å–)`ã€‚sources` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä½ å¯ä»¥æ·»åŠ ä»»æ„å¤šä¸ªã€‚

* `targets` **(è½¬å‘ç›®æ ‡)**
   * ç›®æ ‡å¯ä»¥æ˜¯é¢‘é“æˆ–ç¾¤ç»„ã€‚

   * `default_target`: å¿…éœ€ï¼Œæœªå‘½ä¸­ä»»ä½•åˆ†å‘è§„åˆ™æ—¶çš„é»˜è®¤ç›®æ ‡ï¼Œæ”¯æŒæ•°å­—IDã€@username æˆ– https://t.me/linkã€‚

     *  åŒ¹é…é€»è¾‘: `(æ»¡è¶³æ‰€æœ‰ all_keywords) AND (æ»¡è¶³ä»»ä¸€ any_keywords OR æ»¡è¶³ä»»ä¸€ file_types OR æ»¡è¶³ä»»ä¸€ file_name_patterns)`

     *  `all_keywords`: [AND] æ¶ˆæ¯å¿…é¡»åŒæ—¶åŒ…å«è¿™é‡Œçš„æ‰€æœ‰è¯ã€‚

     *  `any_keywords`: [OR] æ¶ˆæ¯åŒ…å«è¿™é‡Œä»»æ„ä¸€ä¸ªè¯å³å¯ã€‚

     *  `file_types`: [OR] åŒ¹é…æ–‡ä»¶çš„ MIME Type (ä¾‹å¦‚: "video/mp4")ã€‚

     *  `file_name_patterns`: [OR] åŒ¹é…æ–‡ä»¶å (ä¾‹å¦‚: "*.mkv", "1080p")ã€‚

     *  `topic_id`: ç›®æ ‡è¯é¢˜ IDã€‚å¦‚æœç›®æ ‡æ˜¯æ™®é€šé¢‘é“æˆ–ç¾¤ç»„ï¼Œçœç•¥æˆ–è®¾ä¸º nullã€‚

* `forwarding` **(è½¬å‘è¡Œä¸º)**

    > `mode: "copy"`: æ¨èã€‚å¯ä»¥çªç ´æºé¢‘é“"ç¦æ­¢è½¬å‘"çš„é™åˆ¶ã€‚

    > `forward_new_only: true`: æ¨èã€‚`true` è¡¨ç¤ºåªå¤„ç†æ–°æ¶ˆæ¯ï¼›`false` è¡¨ç¤ºä¼šä»å¤´æ‰«ææ‰€æœ‰æºé¢‘é“çš„å†å²æ¶ˆæ¯ã€‚

## è¿‡æ»¤å™¨é€»è¾‘ (é‡è¦)

1. **ç™½åå• (Whitelist) æ¨¡å¼**:

    * å¦‚æœ `whitelist: enable: true`:

    * åªæœ‰ å‘½ä¸­ ç™½åå•çš„æ¶ˆæ¯ä¼š ***[é€šè¿‡]**ï¼Œå¹¶è·³è¿‡æ‰€æœ‰é»‘åå•ã€‚

    * æœªå‘½ä¸­ç™½åå•çš„æ¶ˆæ¯ä¼šè¢« **[è¿‡æ»¤]**ã€‚

2. **é»‘åå• (Blacklist) æ¨¡å¼**:

    * å¦‚æœ `whitelist: enable: false`:

    * æ¶ˆæ¯é»˜è®¤ **[é€šè¿‡]**ã€‚

    * ä½†å¦‚æœ å‘½ä¸­ `ad_filter` æˆ– `content_filter`ï¼Œæ¶ˆæ¯ä¼šè¢« **[è¿‡æ»¤]**ã€‚

3. **é»˜è®¤æ¨¡å¼**:

     * å¦‚æœæ‰€æœ‰è¿‡æ»¤å™¨éƒ½ `enable: false`ï¼Œæ‰€æœ‰æ¶ˆæ¯ **[é€šè¿‡]**ã€‚

# ğŸ“¦ GitHub Actions (è‡ªåŠ¨å‘å¸ƒåˆ° Docker Hub)

æˆ‘å·²ä¸ºä½ æä¾›äº† `.github/workflows/docker-publish.yml` æ–‡ä»¶ã€‚

**ä½ éœ€è¦åšçš„å‡†å¤‡**:

1. **åœ¨ GitHub ä»“åº“ä¸­è®¾ç½® Secrets**:

     * `DOCKER_USERNAME`: ä½ çš„ Docker Hub ç”¨æˆ·åã€‚

     * `DOCKERHUB_TOKEN`: ä½ çš„ Docker Hub è®¿é—®ä»¤ç‰Œ (Access Token)ã€‚

2. **æ£€æŸ¥** `docker-publish.yml`:

    *  `tags` å·²è®¾ç½®ä¸º `${{ secrets.DOCKER_USERNAME }}/tgf:latest` ã€‚

3. **æ¨é€ä»£ç **:

     * å½“ä½ å°†ä»£ç  `push` åˆ° `main` åˆ†æ”¯æ—¶ï¼ŒGitHub Actions å°†è‡ªåŠ¨å¯åŠ¨ã€‚

     * å®ƒä¼šæ„å»º Docker é•œåƒå¹¶å°†å…¶æ¨é€åˆ° `${{ secrets.DOCKER_USERNAME }}/tgf`ã€‚

     * ä¹‹åä½ å°±å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Š `docker pull ${{ secrets.DOCKER_USERNAME }}/tgf:latest` ä½ çš„æœ€æ–°é•œåƒäº†ã€‚

# é¸£è°¢

æœ¬é¡¹ç›®çš„è®¾è®¡å’ŒåŠŸèƒ½çµæ„Ÿæ¥æºäºä»¥ä¸‹é¡¹ç›®å’Œè´¡çŒ®è€…ï¼š

1. [fish2018/tgforwarder](https://github.com/fish2018/TGForwarder)(æä¾›äº†é“¾æ¥æå–ã€å†…å®¹æ›¿æ¢å’Œå¤±æ•ˆé“¾æ¥æ£€æµ‹çš„æ€è·¯)

2. [ccrsrg/tg_zf](https://github.com/CCRSRG/TG_ZF) (æä¾›äº†å¤šè´¦å·ç®¡ç†ã€å†…å®¹è¿‡æ»¤å’Œå»é‡çš„å¥å£®æ¡†æ¶)

3. [Google Gemini](https://gemini.google.com/) (AI åŠ©æ‰‹ï¼ŒååŠ©è¿›è¡Œä»£ç é‡æ„ã€åŠŸèƒ½èåˆå’Œæ–‡æ¡£ç¼–å†™)